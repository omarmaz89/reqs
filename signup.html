<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up</title>
    <link rel="stylesheet" href="style.css">
<script src="https://cdn.jsdelivr.net/npm/appwrite@17.0.0"></script>

</head>
<body>
    <div id="cont">
        <h1 id="title">Create Account</h1>
        <p class="subtitle">Sign up to get started</p>
        
        <!-- Email Input -->
        <div class="input-group">
            <label for="email-input">Email</label>
            <input type="email" id="email-input" placeholder="name@example.com">
            <span class="error-msg" id="email-error"></span>
        </div>
        


        <button class="submit-btn" id="submit">Continue</button>

        <div class="divider"><span>OR</span></div>

        <!-- Google Sign-In -->
        <button class="google-btn" id="gs">
            <img src="https://developers.google.com/identity/images/g-logo.png" alt="Google logo">
            Sign in with Google
        </button>

        <p class="footer-text">
            Already have an account? <a href="signin.html">Sign in</a>
        </p>
    </div>

    <script src="script.js"></script>


<script type="module">
  
  // Initialize Appwrite client
  const client = new Appwrite.Client()
    .setEndpoint("https://fra.cloud.appwrite.io/v1") // Appwrite endpoint
    .setProject("69245280003e7f885796");             // Your project ID

  const account = new Appwrite.Account(client);

  const emailInput = document.getElementById("email-input");
  const signinBtn = document.getElementById('submit');
  const gs = document.getElementById('gs');

async function checkAuthStatus() {
    try {
        // If successful, user is authenticated
        const user = await account.get();
        console.log("User is authenticated:", user);
        // Proceed with your authenticated app flow
        return user;
    } catch (error) {
        console.error("User is not authenticated:", error);
        // Redirect to login page or show login UI
        // window.location.href = '/login';
        return null;
    }
}

// Call this function when your app initializes
checkAuthStatus();

  // -------------------------
  // Email link login
  // -------------------------
  signinBtn.onclick = function() {
    const email = emailInput.value;
    account.createMagicURLSession(
      email,
      window.location.origin + '/verify.html' // redirect after login
    ).then(response => {
      console.log("Magic login link sent to " + email);
      localStorage.setItem('emailForSignIn', email);
    }).catch(error => {
      console.error("Error sending magic link:", error);
    });
  };

  // -------------------------
  // Google OAuth login
  // -------------------------
  gs.onclick = function() {
    account.createOAuth2Session(
      'google',
      window.location.origin, // just redirect to current page
      window.location.origin  // just redirect to current page
    ).catch(error => {
      console.error("Google OAuth error:", error);
    });
  };
</script>

</body>
</html>
